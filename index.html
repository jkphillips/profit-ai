<!-- Landing Page -->
<div id="landing" class="page active">
    <div class="landing">
        <div class="logo-container">
            <div class="logo">
                <div class="logo-text">P</div>
            </div>
        </div>
        <h1>Profit AI</h1>
        <p>Automated crypto trading powered by advanced algorithms. Trade 24/7 while you sleep.</p>
        <div>
            <button class="btn btn-primary" onclick="showPage('login')">Get Started</button>
            <button class="btn btn-secondary" onclick="showPage('signup')">Create Account</button>
        </div>
    </div>
</div>

<!-- Login Page -->
<div id="login" class="page">
    <div class="auth-page">
        <div class="auth-card">
            <h2>Welcome Back</h2>
            <p>Log in to your Profit AI account</p>
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="loginEmail" placeholder="your@email.com" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit" class="btn btn-primary btn-full">Log In</button>
            </form>
            <p style="text-align: center; margin-top: 20px;">
                Don't have an account? <span class="link" onclick="showPage('signup')">Sign up</span>
            </p>
        </div>
    </div>
</div>

<!-- Signup Page -->
<div id="signup" class="page">
    <div class="auth-page">
        <div class="auth-card">
            <h2>Create Account</h2>
            <p>Start trading with Profit AI today</p>
            <form onsubmit="handleSignup(event)">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="signupEmail" placeholder="your@email.com" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="signupPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit" class="btn btn-primary btn-full">Create Account</button>
            </form>
            <p style="text-align: center; margin-top: 20px;">
                Already have an account? <span class="link" onclick="showPage('login')">Log in</span>
            </p>
        </div>
    </div>
</div>

<!-- API Setup Page -->
<div id="api-setup" class="page">
    <div class="auth-page">
        <div class="auth-card">
            <h2>Connect Exchange</h2>
            <p>Link your exchange to start trading</p>
            <form onsubmit="handleApiSetup(event)">
                <div class="form-group">
                    <label>Exchange</label>
                    <select id="exchange" required>
                        <option value="">Select Exchange</option>
                        <option value="binance">Binance</option>
                        <option value="asterdex">Aster Dex</option>
                        <option value="coinbase">Coinbase</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>API Key</label>
                    <input type="text" id="apiKey" placeholder="Enter your API key" required>
                </div>
                <div class="form-group">
                    <label>API Secret</label>
                    <input type="password" id="apiSecret" placeholder="Enter your API secret" required>
                </div>
                <button type="submit" class="btn btn-primary btn-full">Connect & Start Trading</button>
            </form>
        </div>
    </div>
</div>

<!-- Dashboard Page -->
<div id="dashboard" class="page">
    <div class="container main-content">
        <div class="dashboard-header">
            <div class="balance-display">Account Balance</div>
            <div class="balance-amount" id="accountBalance">$0.00</div>
            <div class="balance-change positive" id="balanceChange">
                <span>‚Üó</span>
                <span id="changeAmount">+$0.00 (0.0%)</span>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Win Rate</div>
                <div class="stat-value success" id="winRate">0%</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Today's P&L</div>
                <div class="stat-value" id="todayPL">$0.00</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Trades</div>
                <div class="stat-value" id="totalTrades">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">YTD P&L</div>
                <div class="stat-value" id="ytdPL">$0.00</div>
            </div>
        </div>

        <div class="status-card">
            <div class="status-header">
                <div class="status-indicator" id="statusIndicator"></div>
                <div class="status-text" id="statusText">Analyzing Market</div>
            </div>
            <div class="status-details" id="statusDetails">
                Profit AI algorithm is actively monitoring market conditions. You'll be notified when trades are executed.
            </div>
        </div>

        <div class="chart-container">
            <div class="chart-placeholder">
                <h3>Performance Chart</h3>
                <p>Your account growth over time</p>
            </div>
        </div>
    </div>
</div>

<!-- Trade History Page -->
<div id="history" class="page">
    <div class="container main-content">
        <h2 style="margin-bottom: 24px;">Trade History</h2>
        <div id="tradeHistoryContainer">
            <!-- Trade items will be inserted here -->
        </div>
    </div>
</div>

<!-- Settings Page -->
<div id="settings" class="page">
    <div class="container main-content">
        <h2 style="margin-bottom: 24px;">Settings</h2>
        
        <div class="settings-section">
            <h3>Appearance</h3>
            <div class="setting-item">
                <div>
                    <div style="font-weight: 600; margin-bottom: 4px;">Dark Mode</div>
                    <div style="font-size: 14px; color: var(--text-gray);">Toggle dark theme</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()">
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <div class="settings-section">
            <h3>Trading Settings</h3>
            <div class="setting-item">
                <div>
                    <div style="font-weight: 600; margin-bottom: 4px;">Position Size</div>
                    <div style="font-size: 14px; color: var(--text-gray);">Percentage of balance per trade</div>
                </div>
                <select style="padding: 8px; border-radius: 6px; border: 2px solid var(--border-color);">
                    <option value="100">100%</option>
                    <option value="75">75%</option>
                    <option value="50">50%</option>
                    <option value="25">25%</option>
                </select>
            </div>
            <div class="setting-item">
                <div>
                    <div style="font-weight: 600; margin-bottom: 4px;">Leverage</div>
                    <div style="font-size: 14px; color: var(--text-gray);">Trading leverage multiplier</div>
                </div>
                <select style="padding: 8px; border-radius: 6px; border: 2px solid var(--border-color);">
                    <option value="1">1x</option>
                    <option value="2">2x</option>
                    <option value="5">5x</option>
                    <option value="10" selected>10x</option>
                    <option value="20">20x</option>
                </select>
            </div>
        </div>

        <div class="settings-section">
            <h3>Account</h3>
            <div class="setting-item">
                <div>
                    <div style="font-weight: 600; margin-bottom: 4px;">Connected Exchange</div>
                    <div style="font-size: 14px; color: var(--text-gray);" id="connectedExchange">Not connected</div>
                </div>
                <button class="btn btn-primary" style="padding: 8px 16px; font-size: 14px;" onclick="showPage('api-setup')">Change</button>
            </div>
        </div>

        <button class="btn btn-secondary btn-full" style="margin-top: 24px; background: var(--error-red); color: white; border: none;" onclick="handleLogout()">
            Log Out
        </button>
    </div>
</div>

<!-- ROI Calculator Page -->
<div id="calculator" class="page">
    <div class="container main-content">
        <h2 style="margin-bottom: 24px;">ROI Calculator</h2>
        
        <div class="settings-section">
            <h3>Calculate Your Potential</h3>
            <div class="form-group">
                <label>Starting Balance ($)</label>
                <input type="number" id="roiStartBalance" placeholder="5000" value="5000">
            </div>
            <div class="form-group">
                <label>Expected Win Rate (%)</label>
                <input type="number" id="roiWinRate" placeholder="68" value="68" min="0" max="100">
            </div>
            <div class="form-group">
                <label>Average Profit Per Trade (%)</label>
                <input type="number" id="roiAvgProfit" placeholder="1.0" value="1.0" step="0.1">
            </div>
            <div class="form-group">
                <label>Trades Per Day</label>
                <input type="number" id="roiTradesPerDay" placeholder="3" value="3" min="1">
            </div>
            <div class="form-group">
                <label>Time Period (Days)</label>
                <input type="number" id="roiDays" placeholder="30" value="30" min="1">
            </div>
            <button class="btn btn-primary btn-full" onclick="calculateROI()">Calculate</button>
        </div>

        <div class="settings-section" id="roiResults" style="display: none;">
            <h3>Projected Results</h3>
            <div style="text-align: center; padding: 20px;">
                <div style="font-size: 48px; font-weight: 800; color: var(--success-green); margin-bottom: 16px;" id="roiEndBalance">$0</div>
                <div style="font-size: 18px; color: var(--text-gray); margin-bottom: 8px;">
                    Total Profit: <span style="color: var(--success-green); font-weight: 600;" id="roiTotalProfit">$0</span>
                </div>
                <div style="font-size: 18px; color: var(--text-gray);">
                    ROI: <span style="color: var(--success-green); font-weight: 600;" id="roiPercentage">0%</span>
                </div>
            </div>
            <div style="padding: 16px; background: var(--bg-gray); border-radius: 8px; font-size: 14px; color: var(--text-gray);">
                ‚ö†Ô∏è This is a projection based on historical performance and does not guarantee future results. Past performance is not indicative of future returns.
            </div>
        </div>
    </div>
</div>

<!-- Bottom Navigation -->
<div class="nav">
    <div class="nav-item active" onclick="switchTab('dashboard')">
        <div class="nav-icon">üìä</div>
        <div class="nav-label">Dashboard</div>
    </div>
    <div class="nav-item" onclick="switchTab('history')">
        <div class="nav-icon">üìú</div>
        <div class="nav-label">History</div>
    </div>
    <div class="nav-item" onclick="switchTab('calculator')">
        <div class="nav-icon">üßÆ</div>
        <div class="nav-label">Calculator</div>
    </div>
    <div class="nav-item" onclick="switchTab('settings')">
        <div class="nav-icon">‚öôÔ∏è</div>
        <div class="nav-label">Settings</div>
    </div>
</div>

<!-- Notification -->
<div class="notification" id="notification">
    <div id="notificationText"></div>
</div>

<script>
    // App State
    let appState = {
        balance: 0,
        trades: [],
        isLoggedIn: false,
        exchange: null
    };

    // Page Navigation
    function showPage(pageId) {
        document.querySelectorAll('.page').forEach(page => {
            page.classList.remove('active');
        });
        document.getElementById(pageId).classList.add('active');
    }

    // Tab Navigation
    function switchTab(tabName) {
        document.querySelectorAll('.nav-item').forEach(item => {
            item.classList.remove('active');
        });
        event.currentTarget.classList.add('active');
        showPage(tabName);
    }

    // Authentication
    function handleLogin(event) {
        event.preventDefault();
        appState.isLoggedIn = true;
        showNotification('Login successful!', 'success');
        showPage('api-setup');
    }

    function handleSignup(event) {
        event.preventDefault();
        appState.isLoggedIn = true;
        showNotification('Account created successfully!', 'success');
        showPage('api-setup');
    }

    function handleApiSetup(event) {
        event.preventDefault();
        const exchange = document.getElementById('exchange').value;
        appState.exchange = exchange;
        document.getElementById('connectedExchange').textContent = exchange.charAt(0).toUpperCase() + exchange.slice(1);
        showNotification('Exchange connected! Starting trading bot...', 'success');
        showPage('dashboard');
        startTradingMonitor();
    }

    function handleLogout() {
        if (confirm('Are you sure you want to log out?')) {
            appState.isLoggedIn = false;
            appState.exchange = null;
            showPage('landing');
            showNotification('Logged out successfully', 'success');
        }
    }

    // Dark Mode
    function toggleDarkMode() {
        document.body.classList.toggle('dark-mode');
        localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
    }

    // Load dark mode preference
    if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
        document.getElementById('darkModeToggle').checked = true;
    }

    // Notifications
    function showNotification(message, type = 'success') {
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notificationText');
        
        notificationText.textContent = message;
        notification.className = `notification ${type} show`;
        
        setTimeout(() => {
            notification.classList.remove('show');
        }, 3000);
    }

    // Fetch Real Data from API
    async function fetchRealData() {
        try {
            const response = await fetch('/api/status');
            const data = await response.json();
            
            // Update app state with real data
            appState.balance = data.balance || 0;
            appState.totalTrades = data.totalTrades || 0;
            
            // Update UI
            updateDashboard();
            
        } catch (error) {
            console.error('Error fetching data:', error);
            // Keep trying even if there's an error
        }
    }

    // Update Dashboard
    function updateDashboard() {
        const balance = appState.balance;
        const totalTrades = appState.totalTrades || 0;

        // Update balance display
        document.getElementById('accountBalance').textContent = `$${balance.toFixed(2)}`;
        
        // Update total trades
        document.getElementById('totalTrades').textContent = totalTrades;
        
        // For now, set other stats to 0 since we don't have trade history
        document.getElementById('winRate').textContent = '0%';
        document.getElementById('todayPL').textContent = '$0.00';
        document.getElementById('ytdPL').textContent = '$0.00';
        
        // Update change amount (will be 0 until we track changes)
        document.getElementById('changeAmount').textContent = '+$0.00 (0.0%)';
    }

    // Update Trade History
    function updateTradeHistory() {
        const container = document.getElementById('tradeHistoryContainer');
        
        container.innerHTML = `
            <div style="text-align: center; padding: 40px; color: var(--text-gray);">
                <h3>No trades yet</h3>
                <p>Trades will appear here once the algorithm detects opportunities</p>
            </div>
        `;
    }

    // Start Trading Monitor
    function startTradingMonitor() {
        // Fetch real data immediately
        fetchRealData();
        
        // Then fetch every 5 seconds
        setInterval(fetchRealData, 5000);
        
        // Update status display
        setInterval(() => {
            updateTradingStatus();
        }, 15000);
        
        // Initial status
        updateTradingStatus();
    }

    function updateTradingStatus() {
        const statuses = [
            {
                text: 'Bot Active',
                details: 'Trading bot is connected to Aster Dex and monitoring SUIUSDT market conditions.',
                indicator: ''
            },
            {
                text: 'Analyzing Market',
                details: 'Algorithm is scanning for high-probability trading opportunities.',
                indicator: ''
            },
            {
                text: 'Monitoring SUIUSDT',
                details: 'Waiting for optimal market conditions to execute trades with 10x leverage.',
                indicator: 'waiting'
            }
        ];

        const status = statuses[Math.floor(Math.random() * statuses.length)];
        document.getElementById('statusText').textContent = status.text;
        document.getElementById('statusDetails').textContent = status.details;
        document.getElementById('statusIndicator').className = `status-indicator ${status.indicator}`;
    }

    // ROI Calculator
    function calculateROI() {
        const startBalance = parseFloat(document.getElementById('roiStartBalance').value);
        const winRate = parseFloat(document.getElementById('roiWinRate').value) / 100;
        const avgProfit = parseFloat(document.getElementById('roiAvgProfit').value) / 100;
        const tradesPerDay = parseInt(document.getElementById('roiTradesPerDay').value);
        const days = parseInt(document.getElementById('roiDays').value);

        const totalTrades = tradesPerDay * days;
        const winningTrades = Math.floor(totalTrades * winRate);
        const losingTrades = totalTrades - winningTrades;

        // Simple calculation (compound growth)
        let balance = startBalance;
        for (let i = 0; i < winningTrades; i++) {
            balance += balance * avgProfit;
        }
        for (let i = 0; i < losingTrades; i++) {
            balance -= balance * (avgProfit / 2);
        }

        const totalProfit = balance - startBalance;
        const roiPercent = ((totalProfit / startBalance) * 100).toFixed(2);

        document.getElementById('roiEndBalance').textContent = `$${balance.toFixed(2)}`;
        document.getElementById('roiTotalProfit').textContent = `$${totalProfit.toFixed(2)}`;
        document.getElementById('roiPercentage').textContent = `${roiPercent}%`;
        document.getElementById('roiResults').style.display = 'block';
    }

    // Initialize
    updateDashboard();
    updateTradeHistory();
</script>
